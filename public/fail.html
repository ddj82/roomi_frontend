<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <title>결제 실패</title>
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }
        .payment-result {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            background-color: #fff0f0;
        }
        .error-icon {
            width: 60px;
            height: 60px;
            margin: 0 auto 20px;
            background-color: #e74c3c;
            border-radius: 50%;
            position: relative;
        }
        .error-icon:before, .error-icon:after {
            content: '';
            position: absolute;
            width: 30px;
            height: 4px;
            background-color: white;
            top: 50%;
            left: 50%;
        }
        .error-icon:before {
            transform: translate(-50%, -50%) rotate(45deg);
        }
        .error-icon:after {
            transform: translate(-50%, -50%) rotate(-45deg);
        }
        .redirect-message {
            margin-top: 30px;
            font-size: 14px;
            color: #666;
            font-style: italic;
        }
        .redirect-button {
            margin-top: 20px;
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
        }
        .redirect-button:hover {
            background-color: #2980b9;
        }
        .error-details {
            margin: 20px 0;
            padding: 15px;
            background: #ffebee;
            border-radius: 4px;
            text-align: left;
        }
    </style>
</head>
<body>
<div class="payment-result">
    <div class="error-icon"></div>
    <h1>결제에 실패했습니다</h1>
    <div id="error-details" class="error-details">
        <p>결제 처리 중 오류가 발생했습니다.</p>
    </div>
    <p class="redirect-message">잠시 후 자동으로 앱으로 이동합니다. 자동으로 앱이 열리지 않는 경우 아래 버튼을 클릭하세요.</p>
    <button class="redirect-button" id="openAppButton">앱으로 이동</button>
</div>

<script>
    // URL에서 쿼리 파라미터 추출
    function getUrlParams() {
        const params = {};
        window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(str, key, value) {
            params[key] = decodeURIComponent(value);
        });
        return params;
    }

    // 앱으로 리다이렉트하는 함수
    function redirectToApp() {
        const params = getUrlParams();
        let deepLink = `com.myno1214.roomi://fail`;

        // URL 파라미터를 딥링크에 추가
        if (params.code) {
            deepLink += `?code=${params.code}`;
        }
        if (params.message) {
            deepLink += deepLink.includes('?') ? `&message=${params.message}` : `?message=${params.message}`;
        }
        if (params.orderId) {
            deepLink += deepLink.includes('?') ? `&orderId=${params.orderId}` : `?orderId=${params.orderId}`;
        }

        // 오류 상세 정보 표시
        const errorDetailsElement = document.getElementById('error-details');
        if (params.code && params.message) {
            errorDetailsElement.innerHTML = `
                    <p><strong>오류 코드:</strong> ${params.code}</p>
                    <p><strong>오류 메시지:</strong> ${params.message}</p>
                    ${params.orderId ? `<p><strong>주문번호:</strong> ${params.orderId}</p>` : ''}
                `;
        }

        // 앱으로 리다이렉트
        window.location.href = deepLink;
    }

    // 앱 열기 버튼 클릭 이벤트
    document.getElementById('openAppButton').addEventListener('click', function() {
        redirectToApp();
    });

    // 페이지 로드 시 자동으로 앱 리다이렉트 (2초 후)
    window.onload = function() {
        setTimeout(redirectToApp, 2000);
    };

    // 서버에 오류 정보 전송 (선택사항)
    const sendErrorInfoToServer = async () => {
        const params = getUrlParams();
        if (params.code && params.message) {
            try {
                // 실제 환경에서는 이 부분을 구현하여 서버에 오류 정보 전송
                console.log('오류 정보 서버 전송:', params);
            } catch (error) {
                console.error('서버 전송 오류:', error);
            }
        }
    };

    // 서버 전송 실행 (필요한 경우)
    // sendErrorInfoToServer();
</script>
</body>
</html>