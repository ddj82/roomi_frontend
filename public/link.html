<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>ROOMMATES Co.</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script>
        const userAgent = navigator.userAgent.toLowerCase();
        const isAndroid = userAgent.includes("android");
        const isIOS = /iphone|ipad|ipod/.test(userAgent);

        const iosScheme = "com.myno1214.roomi://";
        const iosAppStore = "https://apps.apple.com/app/id6739731240";
        const androidIntent = "intent://#Intent;scheme=roomi;package=com.myno1214.roomi;end";
        const androidPlayStore = "https://play.google.com/store/apps/details?id=com.myno1214.roomi";

        const getQueryParam = (name) => {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        };

        window.onload = async () => {
            const route = getQueryParam("route") || "unknown";

            try {
                // ✅ POST 요청, 쿼리 스트링으로 전달
                await fetch(`https://roomi.co.kr/api/tracking?route=${encodeURIComponent(route)}`, {
                    method: "POST",
                });
            } catch (e) {
                console.warn("유입 경로 전송 실패:", e);
            }

            // 앱 실행 시도
            if (isAndroid) {
                window.location.href = androidIntent;
                setTimeout(() => {
                    window.location.href = androidPlayStore;
                }, 2000);
            } else if (isIOS) {
                const iframe = document.createElement("iframe");
                iframe.style.display = "none";
                iframe.src = iosScheme;
                document.body.appendChild(iframe);

                setTimeout(() => {
                    window.location.href = iosAppStore;
                }, 2000);
            }
        };
    </script>
</head>
<body>
</body>
</html>