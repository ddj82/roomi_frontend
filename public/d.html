<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í† ìŠ¤í˜ì´ë¨¼ì¸  ê²°ì œ í…ŒìŠ¤íŠ¸</title>
    <script src="https://js.tosspayments.com/v2/standard"></script>
</head>
<body>
<div style="text-align: center; padding: 20px;">
    <h2>í† ìŠ¤í˜ì´ë¨¼ì¸  ê²°ì œ í…ŒìŠ¤íŠ¸</h2>
    <button onclick="initPayment()" style="padding: 10px; font-size: 16px; background-color: #0064FF; color: white; border: none; border-radius: 4px;">ê²°ì œ ìš”ì²­</button>
    <div id="debug-info" style="text-align: left; padding: 10px; font-size: 12px; color: #666; border: 1px solid #ccc; margin-top: 20px; white-space: pre-wrap;"></div>
    <div id="error-message" style="color: red; display: none;"></div>
</div>

<script>
    function addDebugInfo(message, data = null) {
        const debugDiv = document.getElementById('debug-info');
        const timestamp = new Date().toLocaleTimeString();
        let logMessage = `[${timestamp}] ${message}`;

        if (data) {
            logMessage += `\n${JSON.stringify(data, null, 2)}`;
        }

        debugDiv.innerHTML += logMessage + "\n\n";
        console.log(logMessage);

        // Flutter WebViewì™€ í†µì‹  (ì˜¤ë¥˜ ë°©ì§€)
        try {
            if (window.flutter_inappwebview) {
                window.flutter_inappwebview.callHandler('logHandler', message, data);
            }
        } catch (e) {
            console.log('Flutter í†µì‹  ì˜¤ë¥˜:', e);
        }
    }

    // ğŸ”¹ í† ìŠ¤í˜ì´ë¨¼ì¸  ê²°ì œ í‚¤ ì„¤ì •
    const clientKey = "test_ck_D5GePWvyJnrK0W0k6q8gLzN97Eoq"; // âœ… í´ë¼ì´ì–¸íŠ¸ í‚¤

    let tossPayments = null;

    // TossPayments ì´ˆê¸°í™” (ì˜¤ë¥˜ ë°©ì§€)
    try {
        tossPayments = TossPayments(clientKey);
    } catch (e) {
        addDebugInfo("âš ï¸ TossPayments ì´ˆê¸°í™” ì˜¤ë¥˜", e.message);
    }

    function initPayment() {
        if (!tossPayments) {
            addDebugInfo("âŒ TossPaymentsê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
            return;
        }

        const orderId = `test_order_${Date.now()}`;
        const amount = 1000;
        const orderName = "í…ŒìŠ¤íŠ¸ ê²°ì œ ìƒí’ˆ";

        addDebugInfo("ğŸš€ ê²°ì œ ìš”ì²­ ì‹œì‘...", { orderId, amount, orderName });

        // Flutterì— ê²°ì œ ì‹œì‘ ì•Œë¦¼
        try {
            if (window.flutter_inappwebview) {
                window.flutter_inappwebview.callHandler('paymentStarted', orderId, amount);
            }
        } catch (e) {
            console.log("Flutter ê²°ì œ ì‹œì‘ ì•Œë¦¼ ì˜¤ë¥˜:", e);
        }

        tossPayments.requestPayment('ì¹´ë“œ', {
            amount: amount,
            orderId: orderId,
            orderName: orderName,
            customerEmail: "test@example.com",
            customerName: "í…ŒìŠ¤íŠ¸ ìœ ì €",
            successUrl: window.location.origin + "/payment-success",
            failUrl: window.location.origin + "/payment-fail"
        })
            .then((result) => {
                addDebugInfo("âœ… ê²°ì œ ì„±ê³µ!", result);

                // Flutterì— ì„±ê³µ ì•Œë¦¼
                try {
                    if (window.flutter_inappwebview) {
                        window.flutter_inappwebview.callHandler('paymentSuccess', result);
                    }
                } catch (e) {
                    console.log("Flutter ê²°ì œ ì„±ê³µ ì•Œë¦¼ ì˜¤ë¥˜:", e);
                }
            })
            .catch((error) => {
                addDebugInfo("âŒ ê²°ì œ ì‹¤íŒ¨", error);
                document.getElementById('error-message').textContent = `ê²°ì œ ì‹¤íŒ¨: ${error.message}`;
                document.getElementById('error-message').style.display = 'block';

                // Flutterì— ì‹¤íŒ¨ ì•Œë¦¼
                try {
                    if (window.flutter_inappwebview) {
                        window.flutter_inappwebview.callHandler('paymentFailed', error.message, error.code);
                    }
                } catch (e) {
                    console.log("Flutter ê²°ì œ ì‹¤íŒ¨ ì•Œë¦¼ ì˜¤ë¥˜:", e);
                }
            });
    }

    window.onload = function() {
        addDebugInfo('ğŸ“Œ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');

        // Flutterì— ì¤€ë¹„ ì™„ë£Œ ì•Œë¦¼
        try {
            if (window.flutter_inappwebview) {
                window.flutter_inappwebview.callHandler('pageLoaded');
            }
        } catch (e) {
            console.log("Flutter ì¤€ë¹„ ì™„ë£Œ ì•Œë¦¼ ì˜¤ë¥˜:", e);
        }
    };
</script>
</body>
</html>