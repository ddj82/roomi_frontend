<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>í¬íŠ¸ì› ê²°ì œ</title>
    <script src="https://cdn.portone.io/v2/browser-sdk.js"></script>
</head>
<body>
<div style="text-align: center; padding: 20px;">
    <h2>ê²°ì œ ì§„í–‰ ì¤‘...</h2>
    <div id="debug-info" style="text-align: left; padding: 10px; font-size: 12px; color: #666;"></div>
    <div id="error-message" style="color: red; display: none;"></div>
</div>

<script>
    function addDebugInfo(message) {
        const debugDiv = document.getElementById('debug-info');
        const timestamp = new Date().toLocaleTimeString();
        debugDiv.innerHTML += `[${timestamp}] ${message}<br>`;
        console.log(`[${timestamp}] ${message}`);
    }

    const urlParams = new URLSearchParams(window.location.search);
    const params = {
        orderId: urlParams.get('orderId') || `order_${Date.now()}`,
        amount: parseInt(urlParams.get('amount')) || 1000,
        buyerName: urlParams.get('buyerName') || "í™ê¸¸ë™",
        buyerEmail: urlParams.get('buyerEmail') || "test@example.com",
        buyerTel: urlParams.get('buyerTel') || "01012345678",
        buyerAddr: urlParams.get('buyerAddr') || "ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬",
        redirectUrl: urlParams.get('redirectUrl') || "https://roomi.co.kr/success.html",
        channelKey: urlParams.get('channelKey') || "channel-key-14a7fa72-0d06-4bb5-9502-f721b189eb86",
        storeId: urlParams.get('storeId') || "store-7bb98274-0fb5-4b2e-8d60-d3bff2f3ca85"
    };

    window.onload = function () {
        addDebugInfo('ğŸ“¦ PortOne v2 ê²°ì œ ìš”ì²­ ì‹œì‘');

        const paymentRequest = {
            storeId: params.storeId,
            paymentId: params.orderId,
            channelKey: params.channelKey,
            payMethod: 'VIRTUAL_ACCOUNT',
            orderName: "í…ŒìŠ¤íŠ¸ ê²°ì œ ìƒí’ˆ",
            totalAmount: params.amount,
            currency: "KRW",
            customer: {
                customerId: params.buyerTel,
                fullName: params.buyerName,
                phoneNumber: params.buyerTel,
                email: params.buyerEmail,
                address: {
                    addressLine1: params.buyerAddr,
                    addressLine2: "",
                    country: "KR"
                }
            },
            // âœ… virtualAccount ì„¤ì • ìˆ˜ì • - accountExpiryë¥¼ ì˜¬ë°”ë¥¸ ê°ì²´ í˜•íƒœë¡œ ì„¤ì •
            virtualAccount: {
                bank: "KB",                           // ë°œê¸‰ ì€í–‰
                accountExpiry: {
                    validHours: 24  // ìœ íš¨ ê¸°ê°„ì„ validUntilë¡œ ì„¤ì •
                },
                refundBank: "KB",                     // (ì„ íƒ) í™˜ë¶ˆìš©
                refundHolderName: "í™ê¸¸ë™",           // (ì„ íƒ) í™˜ë¶ˆìš©
                refundAccount: "12345678901234"       // (ì„ íƒ) í™˜ë¶ˆìš©
            },
            redirectUrl: params.redirectUrl
        };

        addDebugInfo('ê²°ì œ ìš”ì²­ ë°ì´í„°: ' + JSON.stringify(paymentRequest, null, 2));

        PortOne.requestPayment(paymentRequest)
            .then(result => {
                addDebugInfo("âœ… ê²°ì œ ì„±ê³µ: " + JSON.stringify(result));
                alert("ê°€ìƒê³„ì¢Œ ë°œê¸‰ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!");
                // location.href = `${params.redirectUrl}?success=true&paymentKey=${result.paymentKey}`;
            })
            .catch(error => {
                addDebugInfo("âŒ ê²°ì œ ì‹¤íŒ¨: " + JSON.stringify(error));
                document.getElementById('error-message').textContent = `ê²°ì œ ì‹¤íŒ¨: ${error.message || 'Unknown error'}`;
                document.getElementById('error-message').style.display = 'block';

                // ë” ìì„¸í•œ ì—ëŸ¬ ì •ë³´ í‘œì‹œ
                if (error.details) {
                    addDebugInfo("ì—ëŸ¬ ìƒì„¸: " + JSON.stringify(error.details));
                }
            });
    };
</script>
</body>
</html>